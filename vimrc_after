set autoindent noexpandtab

silent! redir @a
silent! verbose set ts
silent! redir END

" Set ts/sw only if local ftplugin haven't already done so.
let split_verbose = split(@a, "Last set from ")
if len(split_verbose) > 1 && split_verbose[1][0] != "~"
	setlocal ts=4 sw=4
endif

" Searches up the open file's directory tree for a file named .vimrc.local;
" if one exists, sources it.
func! LocalVimrc()
	let cmd = "$HOME/.dotfiles/vim/scripts/local_vimrc.zsh " .
		\ expand("%:p:")

	let local_vimrc_path = system(cmd)
	if len(local_vimrc_path) != 0
		exec "normal! :silent! source " . local_vimrc_path . "\<cr>"
	endif
endfunc

let g:NERDComSNR = GetScriptNumber("NERD_commenter.vim")

" Attempt to expand an UltiSnip snippet; on failure, return " ";
" otherwise, "".
func! UltiSnipExpand()
	if eval(printf("<SNR>%d_IsCommentedNormOrSexy(line('.'))", g:NERDComSNR))
		return " "
	else
		call UltiSnips#ExpandSnippet()
		return (g:ulti_expand_res == 0)?" ":""
	endif
endfunc

silent! call LocalVimrc()
